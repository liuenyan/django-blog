{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
{{ block.super }}
<div class="page-header">
    <h1>{{ post.title }}</h1>
</div>
<div class="panel panel-default">
    <div class="panel-heading">
        {{ post.author.username }} 发表于 <span class="from-now">{{ post.timestamp |date:'c' }}</span>
        <span>
            {% for tag in post.tags.all %}
            {{ tag }}{%if not forloop.last %},{% endif %}
            {% endfor %}
        </span>
    </div>
    <div class="panel-body">
        {{ post.body }}
    </div>
</div>
<div class="post-controls">
    {% if post.author.id == user.id %}
    <a href="{% url 'edit_post' post.id %}" class="btn btn-primary" >编辑</a>
    <a href="{% url 'delete_post' post.id %}" class="btn btn-danger">删除</a>
    {% endif %}
</div>
<div class="post-comments">
    <h2>评论</h2>
    <form action="" method="POST">
        {% csrf_token %}
        <div class="form-group">
            {{ form.name.label_tag }}
            {{ form.name | add_class:'form-control' }}
        </div>
        <div class="form-group">
            {{ form.url.label_tag }}
            {{ form.url | add_class:'form-control' }}
        </div>
        <div class=form-group>
            {{ form.email.label_tag }}
            {{ form.email | add_class:'form-control' }}
        </div>
        <div class="form-group">
            {{ form.comment.label_tag }}
            {{ form.comment | add_class:'form-control' }}
        </div>
        <input type="submit" class="btn btn-primary" value="提交">   
    </form>
    <ul class="list-group" style="padding-top: 50px;">
        {% for comment in comments %}
        <li class="list-group-item {% cycle 'list-group-item-warning' 'list-group-item-info' %}">
            <p><span class="label label-default">#{{forloop.counter }}</span> <span class="label label-info"><a href="{{ comment.url }}">{{ comment.name }}</a></span> 发布于 <span class="from-now">{{ comment.timestamp | date:'c' }}</span>
            <p>{{ comment.comment }}</p>
        </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="//cdn.bootcss.com/moment.js/2.11.2/moment.min.js"></script>
<script src="//cdn.bootcss.com/moment.js/2.11.2/locale/zh-cn.js"></script>
<script>
moment.locale('zh-cn');
$('.from-now').each(function(){
    var text = moment($(this).text()).fromNow();
    $(this).text(text);
});
</script>
{% endblock %}
