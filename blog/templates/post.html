{% extends "base.html" %}
{% load widget_tweaks %}

{% block title %}{{ post.title }}{% endblock %}

{% block content %}
{{ block.super }}
<div class="page-header">
    <h1>{{ post.title }}</h1>
</div>
<div class="post-info">
    <span class="label label-danger">{{ post.author.username }}</span> 发表于 <span class="from-now">{{ post.timestamp |date:'c' }}</span>
    <span>
        {% for tag in post.tags.all %}
        <a href="{% url 'tag' tag %}"><span class="label label-primary">{{ tag }}</span></a>&nbsp;
        {% endfor %}
    </span>
</div>
<div class="post-body">
    {{ post.body }}
</div>
<div class="post-controls">
    {% if post.author.id == user.id %}
    <a href="{% url 'edit_post' post.id %}" class="btn btn-primary"><span class="glyphicon glyphicon-edit"></span> 编辑</a>
    <a href="{% url 'delete_post' post.id %}" class="btn btn-danger"><span class="glyphicon glyphicon-trash"></span> 删除</a>
    {% endif %}
</div>
<div class="post-comments">
   <h4><span class="glyphicon glyphicon-comment"></span> 评论列表</h4>
    <ul class="comments">
        {% for comment in comments %}
        <li class="{% cycle 'comment-odd' 'comment-even' %}">
            <p><span class="label label-default">#{{forloop.counter }}</span> <a href="{{ comment.url }}"><span class="label label-primary">{{ comment.name }}</span></a> 发布于 <span class="from-now">{{ comment.timestamp | date:'c' }}</span>
            <p>{{ comment.comment }}</p>
        </li>
        {% endfor %}
    </ul>
    <h4><span class="glyphicon glyphicon-comment"></span> 留下您的评论</h4>
    <form action="" method="POST">
        {% csrf_token %}
        <div class="form-group">
            {{ form.name.label_tag }}
            {{ form.name | add_class:'form-control'| attr:'placeholder:您的名字' }}
        </div>
        <div class="form-group">
            {{ form.url.label_tag }}
            {{ form.url | add_class:'form-control' | attr:'placeholder:http://'}}
        </div>
        <div class=form-group>
            {{ form.email.label_tag }}
            {{ form.email | add_class:'form-control' |attr:'placeholder:user@example.com'}}
        </div>
        <div class="form-group">
            {{ form.comment.label_tag }}
            {{ form.comment | add_class:'form-control' |attr:'placeholder:输入您的评论'}}
        </div>
        <input type="submit" class="btn btn-primary" value="提交">   
    </form>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="//cdn.bootcss.com/moment.js/2.11.2/moment.min.js"></script>
<script src="//cdn.bootcss.com/moment.js/2.11.2/locale/zh-cn.js"></script>
<script>
moment.locale('zh-cn');
$('.from-now').each(function(){
    var text = moment($(this).text()).fromNow();
    $(this).text(text);
});
</script>
{% endblock %}
